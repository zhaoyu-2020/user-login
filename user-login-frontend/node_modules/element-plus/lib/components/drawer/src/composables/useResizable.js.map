{"version":3,"file":"useResizable.js","sources":["../../../../../../../packages/components/drawer/src/composables/useResizable.ts"],"sourcesContent":["import { computed, onBeforeUnmount, ref, watch } from 'vue'\nimport { addUnit } from '@element-plus/utils'\nimport { clamp, useEventListener, useWindowSize } from '@vueuse/core'\n\nimport type { Ref, SetupContext } from 'vue'\nimport type { DrawerEmits, DrawerProps } from '../drawer'\n\nexport function useResizable(\n  props: DrawerProps & Required<Pick<DrawerProps, 'direction'>>,\n  target: Ref<HTMLElement | undefined>,\n  emit: SetupContext<DrawerEmits>['emit']\n) {\n  const { width, height } = useWindowSize()\n\n  const isHorizontal = computed(() => ['ltr', 'rtl'].includes(props.direction))\n  const sign = computed(() =>\n    ['ltr', 'ttb'].includes(props.direction) ? 1 : -1\n  )\n  const windowSize = computed(() =>\n    isHorizontal.value ? width.value : height.value\n  )\n  const getSize = computed(() => {\n    return clamp(\n      startSize.value + sign.value * offset.value,\n      4,\n      windowSize.value\n    )\n  })\n\n  const startSize = ref(0)\n  const offset = ref(0)\n  const isResizing = ref(false)\n  const hasStartedDragging = ref(false)\n  let startPos: number[] = []\n  let cleanups: (() => void)[] = []\n\n  const getActualSize = () => {\n    const drawerEl = target.value?.closest('[aria-modal=\"true\"]') as HTMLElement\n    if (drawerEl) {\n      return isHorizontal.value ? drawerEl.offsetWidth : drawerEl.offsetHeight\n    }\n    return 100\n  }\n\n  watch(\n    () => [props.size, props.resizable] as const,\n    () => {\n      hasStartedDragging.value = false\n      startSize.value = 0\n      offset.value = 0\n      onMouseUp()\n    }\n  )\n\n  const onMousedown = (e: MouseEvent) => {\n    if (!props.resizable) return\n\n    if (!hasStartedDragging.value) {\n      startSize.value = getActualSize()\n      hasStartedDragging.value = true\n    }\n\n    startPos = [e.pageX, e.pageY]\n    isResizing.value = true\n    emit('resize-start', e, startSize.value)\n    cleanups.push(\n      useEventListener(window, 'mouseup', onMouseUp),\n      useEventListener(window, 'mousemove', onMouseMove)\n    )\n  }\n\n  const onMouseMove = (e: MouseEvent) => {\n    const { pageX, pageY } = e\n    const offsetX = pageX - startPos[0]\n    const offsetY = pageY - startPos[1]\n    offset.value = isHorizontal.value ? offsetX : offsetY\n    emit('resize', e, getSize.value)\n  }\n\n  const onMouseUp = (e?: MouseEvent) => {\n    // premature interruption\n    // avoid triggering meaningless execution due to watch size/resizable constraints.\n    if (!isResizing.value) return\n\n    startPos = []\n    startSize.value = getSize.value\n    offset.value = 0\n    isResizing.value = false\n    cleanups.forEach((cleanup) => cleanup?.())\n    cleanups = []\n    if (e) {\n      emit('resize-end', e, startSize.value)\n    }\n  }\n\n  const cleanup = useEventListener(target, 'mousedown', onMousedown)\n\n  onBeforeUnmount(() => {\n    cleanup()\n    onMouseUp()\n  })\n\n  return {\n    size: computed(() => {\n      return hasStartedDragging.value\n        ? `${getSize.value}px`\n        : addUnit(props.size)\n    }),\n    isResizing,\n    isHorizontal,\n  }\n}\n"],"names":["useWindowSize","computed","clamp","ref","watch","useEventListener","cleanup","onBeforeUnmount","addUnit"],"mappings":"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"}