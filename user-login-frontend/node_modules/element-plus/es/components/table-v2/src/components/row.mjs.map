{"version":3,"file":"row.mjs","sources":["../../../../../../../packages/components/table-v2/src/components/row.tsx"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  inject,\n  nextTick,\n  onMounted,\n  ref,\n  unref,\n} from 'vue'\nimport { isArray, isFunction, isNumber } from '@element-plus/utils'\nimport { tableV2RowProps } from '../row'\nimport { TableV2InjectionKey } from '../tokens'\nimport { placeholderSign } from '../private'\n\nimport type { CSSProperties, RendererElement, RendererNode, VNode } from 'vue'\nimport type { RowEventHandlers, TableV2RowProps } from '../row'\n\ntype CustomizedCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[]\n\ntype DefaultCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[][]\n\ntype ColumnCellsType = DefaultCellsType | CustomizedCellsType\n\nconst useTableRow = (props: TableV2RowProps) => {\n  const { isScrolling } = inject(TableV2InjectionKey)!\n\n  const measured = ref(false)\n  const rowRef = ref<HTMLElement>()\n  const measurable = computed(() => {\n    return isNumber(props.estimatedRowHeight) && props.rowIndex >= 0\n  })\n\n  const doMeasure = (isInit = false) => {\n    const $rowRef = unref(rowRef)\n    if (!$rowRef) return\n    const { columns, onRowHeightChange, rowKey, rowIndex, style } = props\n    const { height } = $rowRef.getBoundingClientRect()\n    measured.value = true\n\n    nextTick(() => {\n      if (isInit || height !== Number.parseInt(style!.height as string)) {\n        const firstColumn = columns[0]\n        const isPlaceholder = firstColumn?.placeholderSign === placeholderSign\n        onRowHeightChange?.(\n          { rowKey, height, rowIndex },\n          firstColumn && !isPlaceholder && firstColumn.fixed\n        )\n      }\n    })\n  }\n\n  const eventHandlers = computed(() => {\n    const { rowData, rowIndex, rowKey, onRowHover } = props\n    const handlers = props.rowEventHandlers || ({} as RowEventHandlers)\n    const eventHandlers = {} as {\n      [key in keyof RowEventHandlers]: (e: Event) => void\n    }\n\n    Object.entries(handlers).forEach(([eventName, handler]) => {\n      if (isFunction(handler)) {\n        eventHandlers[eventName as keyof RowEventHandlers] = (event: Event) => {\n          handler({\n            event,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n        }\n      }\n    })\n\n    if (onRowHover) {\n      ;(\n        [\n          { name: 'onMouseleave', hovered: false },\n          { name: 'onMouseenter', hovered: true },\n        ] as const\n      ).forEach(({ name, hovered }) => {\n        const existedHandler = eventHandlers[name]\n        eventHandlers[name] = ((event: MouseEvent) => {\n          onRowHover({\n            event,\n            hovered,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n\n          existedHandler?.(event)\n        }) as any\n      })\n    }\n    return eventHandlers\n  })\n\n  const onExpand = (expanded: boolean) => {\n    const { onRowExpand, rowData, rowIndex, rowKey } = props\n\n    onRowExpand?.({\n      expanded,\n      rowData,\n      rowIndex,\n      rowKey,\n    })\n  }\n\n  onMounted(() => {\n    if (unref(measurable)) {\n      doMeasure(true)\n    }\n  })\n\n  return { isScrolling, measurable, measured, rowRef, eventHandlers, onExpand }\n}\n\nconst COMPONENT_NAME = 'ElTableV2TableRow'\n\nconst TableV2Row = defineComponent({\n  name: COMPONENT_NAME,\n  props: tableV2RowProps,\n  setup(props, { expose, slots, attrs }) {\n    const {\n      eventHandlers,\n      isScrolling,\n      measurable,\n      measured,\n      rowRef,\n\n      onExpand,\n    } = useTableRow(props)\n\n    expose({\n      /**\n       * @description manually dispatching expand action on row.\n       */\n      onExpand,\n    })\n\n    return () => {\n      const {\n        columns,\n        columnsStyles,\n        expandColumnKey,\n        depth,\n        rowData,\n        rowIndex,\n        style,\n      } = props\n\n      let ColumnCells: ColumnCellsType = columns.map((column, columnIndex) => {\n        const expandable =\n          isArray(rowData.children) &&\n          rowData.children.length > 0 &&\n          column.key === expandColumnKey\n\n        return slots.cell!({\n          column,\n          columns,\n          columnIndex,\n          depth,\n          style: columnsStyles[column.key!],\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n          expandIconProps: expandable\n            ? {\n                rowData,\n                rowIndex,\n                onExpand,\n              }\n            : undefined,\n        })\n      })\n\n      if (slots.row) {\n        ColumnCells = slots.row({\n          cells: ColumnCells.map((node) => {\n            if (isArray(node) && node.length === 1) {\n              return node[0]\n            }\n            return node\n          }),\n          style,\n          columns,\n          depth,\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n        })\n      }\n\n      if (unref(measurable)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { height, ...exceptHeightStyle } = style || {}\n        const _measured = unref(measured)\n        return (\n          <div\n            ref={rowRef}\n            class={props.class}\n            style={_measured ? style : exceptHeightStyle}\n            role=\"row\"\n            {...attrs}\n            {...unref(eventHandlers)}\n          >\n            {ColumnCells}\n          </div>\n        )\n      }\n\n      return (\n        <div\n          {...attrs}\n          ref={rowRef}\n          class={props.class}\n          style={style}\n          role=\"row\"\n          {...unref(eventHandlers)}\n        >\n          {ColumnCells}\n        </div>\n      )\n    }\n  },\n})\n\nexport default TableV2Row\n\nexport type TableV2RowCellRenderParam = {\n  column: TableV2RowProps['columns'][number]\n  columns: TableV2RowProps['columns']\n  columnIndex: number\n  depth: number\n  style: CSSProperties\n  rowData: any\n  rowIndex: number\n  isScrolling: boolean\n  expandIconProps?: {\n    rowData: any\n    rowIndex: number\n    onExpand: (expand: boolean) => void\n  }\n}\n"],"names":["useTableRow","props","isScrolling","inject","TableV2InjectionKey","measured","ref","rowRef","measurable","computed","isNumber","estimatedRowHeight","rowIndex","doMeasure","isInit","$rowRef","unref","columns","onRowHeightChange","rowKey","style","height","getBoundingClientRect","value","nextTick","Number","parseInt","firstColumn","isPlaceholder","placeholderSign","fixed","eventHandlers","rowData","onRowHover","handlers","rowEventHandlers","Object","entries","forEach","eventName","handler","isFunction","event","name","hovered","existedHandler","onExpand","expanded","onRowExpand","onMounted","COMPONENT_NAME","TableV2Row","defineComponent","tableV2RowProps","setup","expose","slots","attrs","columnsStyles","expandColumnKey","depth","ColumnCells","map","column","columnIndex","expandable","isArray","children","length","key","cell","expandIconProps","undefined","row","cells","node","exceptHeightStyle","_measured","_createVNode","_mergeProps","class"],"mappings":"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"}