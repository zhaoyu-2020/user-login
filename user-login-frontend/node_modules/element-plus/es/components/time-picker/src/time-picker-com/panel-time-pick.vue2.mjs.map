{"version":3,"file":"panel-time-pick.vue2.mjs","sources":["../../../../../../../packages/components/time-picker/src/time-picker-com/panel-time-pick.vue"],"sourcesContent":["<template>\n  <transition :name=\"transitionName\">\n    <div v-if=\"actualVisible || visible\" :class=\"ns.b('panel')\">\n      <div :class=\"[ns.be('panel', 'content'), { 'has-seconds': showSeconds }]\">\n        <time-spinner\n          ref=\"spinner\"\n          :role=\"datetimeRole || 'start'\"\n          :arrow-control=\"arrowControl\"\n          :show-seconds=\"showSeconds\"\n          :am-pm-mode=\"amPmMode\"\n          :spinner-date=\"\n            // https://github.com/vuejs/language-tools/issues/2104#issuecomment-3092541527\n            parsedValue as any\n          \"\n          :disabled-hours=\"disabledHours\"\n          :disabled-minutes=\"disabledMinutes\"\n          :disabled-seconds=\"disabledSeconds\"\n          @change=\"handleChange\"\n          @set-option=\"onSetOption\"\n          @select-range=\"setSelectionRange\"\n        />\n      </div>\n      <div :class=\"ns.be('panel', 'footer')\">\n        <button\n          type=\"button\"\n          :class=\"[ns.be('panel', 'btn'), 'cancel']\"\n          @click=\"handleCancel\"\n        >\n          {{ t('el.datepicker.cancel') }}\n        </button>\n        <button\n          type=\"button\"\n          :class=\"[ns.be('panel', 'btn'), 'confirm']\"\n          @click=\"handleConfirm()\"\n        >\n          {{ t('el.datepicker.confirm') }}\n        </button>\n      </div>\n    </div>\n  </transition>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, inject, nextTick, ref } from 'vue'\nimport dayjs from 'dayjs'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useLocale, useNamespace } from '@element-plus/hooks'\nimport { getEventCode, isUndefined } from '@element-plus/utils'\nimport { PICKER_BASE_INJECTION_KEY } from '../constants'\nimport { panelTimePickerProps } from '../props/panel-time-picker'\nimport { useTimePanel } from '../composables/use-time-panel'\nimport {\n  buildAvailableTimeSlotGetter,\n  useOldValue,\n} from '../composables/use-time-picker'\nimport TimeSpinner from './basic-time-spinner.vue'\n\nimport type { Dayjs } from 'dayjs'\n\nconst props = defineProps(panelTimePickerProps)\nconst emit = defineEmits(['pick', 'select-range', 'set-picker-option'])\n\n// Injections\nconst pickerBase = inject(PICKER_BASE_INJECTION_KEY) as any\nconst {\n  arrowControl,\n  disabledHours,\n  disabledMinutes,\n  disabledSeconds,\n  defaultValue,\n} = pickerBase.props\nconst { getAvailableHours, getAvailableMinutes, getAvailableSeconds } =\n  buildAvailableTimeSlotGetter(disabledHours, disabledMinutes, disabledSeconds)\n\nconst ns = useNamespace('time')\nconst { t, lang } = useLocale()\n// data\nconst selectionRange = ref([0, 2])\nconst oldValue = useOldValue(props)\n// computed\nconst transitionName = computed(() => {\n  return isUndefined(props.actualVisible)\n    ? `${ns.namespace.value}-zoom-in-top`\n    : ''\n})\nconst showSeconds = computed(() => {\n  return props.format.includes('ss')\n})\nconst amPmMode = computed(() => {\n  if (props.format.includes('A')) return 'A'\n  if (props.format.includes('a')) return 'a'\n  return ''\n})\n// method\nconst isValidValue = (_date: Dayjs) => {\n  const parsedDate = dayjs(_date).locale(lang.value)\n  const result = getRangeAvailableTime(parsedDate)\n  return parsedDate.isSame(result)\n}\nconst handleCancel = () => {\n  const old = oldValue.value\n  emit('pick', old, false)\n  nextTick(() => {\n    oldValue.value = old\n  })\n}\nconst handleConfirm = (visible = false, first = false) => {\n  if (first) return\n  emit('pick', props.parsedValue, visible)\n}\nconst handleChange = (_date: Dayjs) => {\n  // visible avoids edge cases, when use scrolls during panel closing animation\n  if (!props.visible) {\n    return\n  }\n  const result = getRangeAvailableTime(_date).millisecond(0)\n  emit('pick', result, true)\n}\n\nconst setSelectionRange = (start: number, end: number) => {\n  emit('select-range', start, end)\n  selectionRange.value = [start, end]\n}\n\nconst changeSelectionRange = (step: number) => {\n  const actualFormat = props.format\n  const hourIndex = actualFormat.indexOf('HH')\n  const minuteIndex = actualFormat.indexOf('mm')\n  const secondIndex = actualFormat.indexOf('ss')\n  const list: number[] = []\n  const mapping: string[] = []\n  if (hourIndex !== -1) {\n    list.push(hourIndex)\n    mapping.push('hours')\n  }\n  if (minuteIndex !== -1) {\n    list.push(minuteIndex)\n    mapping.push('minutes')\n  }\n  if (secondIndex !== -1 && showSeconds.value) {\n    list.push(secondIndex)\n    mapping.push('seconds')\n  }\n\n  const index = list.indexOf(selectionRange.value[0])\n  const next = (index + step + list.length) % list.length\n  timePickerOptions['start_emitSelectRange'](mapping[next])\n}\n\nconst handleKeydown = (event: KeyboardEvent) => {\n  const code = getEventCode(event)\n\n  const { left, right, up, down } = EVENT_CODE\n\n  if ([left, right].includes(code)) {\n    const step = code === left ? -1 : 1\n    changeSelectionRange(step)\n    event.preventDefault()\n    return\n  }\n\n  if ([up, down].includes(code)) {\n    const step = code === up ? -1 : 1\n    timePickerOptions['start_scrollDown'](step)\n    event.preventDefault()\n    return\n  }\n}\n\nconst { timePickerOptions, onSetOption, getAvailableTime } = useTimePanel({\n  getAvailableHours,\n  getAvailableMinutes,\n  getAvailableSeconds,\n})\n\nconst getRangeAvailableTime = (date: Dayjs) => {\n  return getAvailableTime(date, props.datetimeRole || '', true)\n}\n\nconst parseUserInput = (value: Dayjs) => {\n  if (!value) return null\n  return dayjs(value, props.format).locale(lang.value)\n}\n\nconst getDefaultValue = () => {\n  return dayjs(defaultValue).locale(lang.value)\n}\n\nemit('set-picker-option', ['isValidValue', isValidValue])\nemit('set-picker-option', ['parseUserInput', parseUserInput])\nemit('set-picker-option', ['handleKeydownInput', handleKeydown])\nemit('set-picker-option', ['getRangeAvailableTime', getRangeAvailableTime])\nemit('set-picker-option', ['getDefaultValue', getDefaultValue])\n</script>\n"],"names":["_createBlock","_Transition","actualVisible","visible","_createElementBlock","_normalizeClass","_unref","_createElementVNode","_createVNode","TimeSpinner","datetimeRole","parsedValue"],"mappings":"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"}