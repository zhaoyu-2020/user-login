{"version":3,"file":"helper.mjs","sources":["../../../../../../packages/components/mention/src/helper.ts"],"sourcesContent":["import { ensureArray, isFirefox } from '@element-plus/utils'\n\nimport type { MentionCtx, MentionOption } from './types'\n\nexport const filterOption = (\n  pattern: string,\n  option: MentionOption\n): boolean => {\n  const lowerCase = pattern.toLowerCase()\n  const label = option.label || option.value || ''\n  return label.toLowerCase().includes(lowerCase)\n}\n\nexport const getMentionCtx = (\n  inputEl: HTMLInputElement | HTMLTextAreaElement,\n  prefix: string | string[],\n  split: string\n) => {\n  const { selectionEnd } = inputEl\n  if (selectionEnd === null) return\n  const inputValue = inputEl.value\n  const prefixArray = ensureArray(prefix)\n  let splitIndex = -1\n  let mentionCtx: MentionCtx | undefined\n  for (let i = selectionEnd - 1; i >= 0; --i) {\n    const char = inputValue[i]\n    if (char === split || char === '\\n' || char === '\\r') {\n      splitIndex = i\n      continue\n    }\n    if (prefixArray.includes(char)) {\n      const end = splitIndex === -1 ? selectionEnd : splitIndex\n      const pattern = inputValue.slice(i + 1, end)\n      mentionCtx = {\n        pattern,\n        start: i + 1,\n        end,\n        prefix: char,\n        prefixIndex: i,\n        splitIndex,\n        selectionEnd,\n      }\n      break\n    }\n  }\n  return mentionCtx\n}\n\n/**\n * fork from textarea-caret-position\n * https://github.com/component/textarea-caret-position\n * The MIT License (MIT)\n * Copyright (c) 2015 Jonathan Ong me@jongleberry.com\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nexport const getCursorPosition = (\n  element: HTMLInputElement | HTMLTextAreaElement,\n  options = {\n    debug: false,\n    useSelectionEnd: false,\n  }\n) => {\n  const selectionStart =\n    element.selectionStart !== null ? element.selectionStart : 0\n  const selectionEnd = element.selectionEnd !== null ? element.selectionEnd : 0\n  const position = options.useSelectionEnd ? selectionEnd : selectionStart\n  // We'll copy the properties below into the mirror div.\n  // Note that some browsers, such as Firefox, do not concatenate properties\n  // into their shorthand (e.g. padding-top, padding-bottom etc. -> padding),\n  // so we have to list every single property explicitly.\n  const properties: string[] = [\n    'direction', // RTL support\n    'boxSizing',\n    'width', // on Chrome and IE, exclude the scrollbar, so the mirror div wraps exactly as the textarea does\n    'height',\n    'overflowX',\n    'overflowY', // copy the scrollbar for IE\n    'borderTopWidth',\n    'borderRightWidth',\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderStyle',\n    'paddingTop',\n    'paddingRight',\n    'paddingBottom',\n    'paddingLeft',\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/font\n    'fontStyle',\n    'fontVariant',\n    'fontWeight',\n    'fontStretch',\n    'fontSize',\n    'fontSizeAdjust',\n    'lineHeight',\n    'fontFamily',\n    'textAlign',\n    'textTransform',\n    'textIndent',\n    'textDecoration', // might not make a difference, but better be safe\n    'letterSpacing',\n    'wordSpacing',\n    'tabSize',\n    'MozTabSize',\n  ]\n\n  if (options.debug) {\n    const el = document.querySelector(\n      '#input-textarea-caret-position-mirror-div'\n    )\n    if (el?.parentNode) el.parentNode.removeChild(el)\n  }\n\n  // The mirror div will replicate the textareas style\n  const div = document.createElement('div')\n  div.id = 'input-textarea-caret-position-mirror-div'\n  document.body.appendChild(div)\n\n  const style = div.style\n  const computed = window.getComputedStyle(element)\n\n  const isInput = element.nodeName === 'INPUT'\n\n  // Default textarea styles\n  style.whiteSpace = isInput ? 'nowrap' : 'pre-wrap'\n  if (!isInput) style.wordWrap = 'break-word' // only for textarea-s\n\n  // Position off-screen\n  style.position = 'absolute' // required to return coordinates properly\n  if (!options.debug) style.visibility = 'hidden' // not 'display: none' because we want rendering\n\n  // Transfer the element's properties to the div\n  properties.forEach((prop) => {\n    if (isInput && prop === 'lineHeight') {\n      // Special case for <input>s because text is rendered centered and line height may be != height\n      if (computed.boxSizing === 'border-box') {\n        const height = Number.parseInt(computed.height as string)\n        const outerHeight =\n          Number.parseInt(computed.paddingTop as string) +\n          Number.parseInt(computed.paddingBottom as string) +\n          Number.parseInt(computed.borderTopWidth as string) +\n          Number.parseInt(computed.borderBottomWidth as string)\n        const targetHeight =\n          outerHeight + Number.parseInt(computed.lineHeight as string)\n        if (height > targetHeight) {\n          style.lineHeight = `${height - outerHeight}px`\n        } else if (height === targetHeight) {\n          style.lineHeight = computed.lineHeight\n        } else {\n          style.lineHeight = '0'\n        }\n      } else {\n        style.lineHeight = computed.height\n      }\n    } else {\n      style[prop as any] = computed[prop as any]\n    }\n  })\n\n  if (isFirefox()) {\n    // Firefox lies about the overflow property for textareas: https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n    if (element.scrollHeight > Number.parseInt(computed.height as string)) {\n      style.overflowY = 'scroll'\n    }\n  } else {\n    style.overflow = 'hidden' // for Chrome to not render a scrollbar; IE keeps overflowY = 'scroll'\n  }\n\n  div.textContent = element.value.slice(0, Math.max(0, position))\n  // The second special handling for input type=\"text\" vs textarea:\n  // spaces need to be replaced with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n  if (isInput && div.textContent) {\n    div.textContent = div.textContent.replace(/\\s/g, '\\u00A0')\n  }\n\n  const span = document.createElement('span')\n  // Wrapping must be replicated *exactly*, including when a long word gets\n  // onto the next line, with whitespace at the end of the line before (#7).\n  // The  *only* reliable way to do that is to copy the *entire* rest of the\n  // textareas content into the <span> created at the caret position.\n  // For inputs, just '.' would be enough, but no need to bother.\n  span.textContent = element.value.slice(Math.max(0, position)) || '.' // || because a completely empty faux span doesn't render at all\n  span.style.position = 'relative'\n  span.style.left = `${-element.scrollLeft}px`\n  span.style.top = `${-element.scrollTop}px`\n  div.appendChild(span)\n\n  const relativePosition = {\n    top: span.offsetTop + Number.parseInt(computed.borderTopWidth as string),\n    left: span.offsetLeft + Number.parseInt(computed.borderLeftWidth as string),\n    // We don't use line-height since it may be too large for position. Eg. 34px\n    // for input\n    height: Number.parseInt(computed.fontSize as string) * 1.5,\n  }\n\n  if (options.debug) {\n    span.style.backgroundColor = '#aaa'\n  } else {\n    document.body.removeChild(div)\n  }\n\n  if (relativePosition.left >= element.clientWidth) {\n    relativePosition.left = element.clientWidth\n  }\n  return relativePosition\n}\n"],"names":["ensureArray"],"mappings":"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"}